<!DOCTYPE html>
<html lang="en">
<head>
        <title>IRCParser (dialect.parsing.IRCParser)</title>
	<meta charset="utf-8" />
	<meta content="width=device-width, initial-scale=1" name="viewport" />
        <link href="style.css" rel="stylesheet" />
        <script src="script.js" type="text/javascript"></script>

	
	<link href="search-results.html" rel="prefetch" />
</head>
<body>
	<div id="page-header">
		<div id="logotype">
		<span>kameloso IRC bot</span>
		<nav>
			<a href="http://dlang.org/">Dlang.org</a>
		</nav>
		</div>

		<form action="search-docs.html" id="search">
			<input name="searchTerm" placeholder="Find a symbol name..." type="search" />
			<input type="submit" value="Go" />
		</form>
	</div>
	<div id="page-body">
		<div id="page-content">
		<h1>IRCParser</h1><div class="breadcrumbs"><a class="breadcrumb" href="dialect.html">dialect</a> <a class="breadcrumb" href="dialect.parsing.html">parsing</a> </div><div><div class="documentation-comment synopsis"><div><p>Parser that takes raw IRC strings and produces <a class="xref" href="dialect.defs.IRCEvent.html">IRCEvent</a>s based on them.</p><p>Parsing requires state, which means that <a class="xref" href="dialect.parsing.IRCParser.html">IRCParser</a>s must be equipped with
    a <a class="xref" href="dialect.defs.IRCServer.html">IRCServer</a> and a <a class="xref" href="dialect.defs.IRCClient.html">IRCClient</a> for context when parsing.
    Because of this it has its postblit <tt class="inline-code">@disable</tt>d, so as not to make copies
    when only one instance should exist.</p><p>The alternative is to make it a class, which works too.</p><p>See the <tt class="inline-code">/tests</tt> directory for unit tests.</p></div></div></div><div class="annotated-prototype"><div class="aggregate-prototype"><div class="attributes"></div><span class="builtin-type">struct</span> IRCParser  {<div class="aggregate-member"><a href="dialect.parsing.IRCParser.client.html"><div class="attributes"></div><tt class="highlighted"><span class="hid">IRCClient</span></tt> <span class="name">client</span>;</a></div><div class="aggregate-member"><a href="dialect.parsing.IRCParser.server.html"><div class="attributes"></div><tt class="highlighted"><span class="hid">IRCServer</span></tt> <span class="name">server</span>;</a></div><div class="aggregate-member"><a href="dialect.parsing.IRCParser.typenums.html"><div class="attributes"></div><tt class="highlighted"><span class="hid">IRCEvent</span>.<span class="hid">Type</span>[<span class="num">1024</span>]</tt> <span class="name">typenums</span>;</a></div><div class="aggregate-member"><a href="dialect.parsing.IRCParser.toIRCEvent.html"><span class="lang-feature">auto</span>  <span class="name">toIRCEvent</span>(string raw);</a></div><div class="aggregate-member"><a href="dialect.parsing.IRCParser.this.1.html"><span class="lang-feature name">this</span>(IRCClient client, IRCServer server);</a></div><div class="aggregate-member"><a href="dialect.parsing.IRCParser.this.2.html"><span class="lang-feature name">this</span>(IRCClient client, IRCServer server);</a></div><div class="aggregate-member"><a href="dialect.parsing.IRCParser.this(this).html"><span class="lang-feature name">this(this)</span>;</a></div><div class="aggregate-member"><a href="dialect.postprocessors.Postprocessor.html"><span class="builtin-type">interface</span> <span class="name">Postprocessor</span> via <tt class="highlighted">
<span class="kwrd">import</span> <span class="hid">dialect</span>.<span class="hid">postprocessors</span> : <span class="hid">Postprocessor</span>;</tt>;</a></div><div class="aggregate-member"><a href="dialect.parsing.IRCParser.postprocessors.html"><div class="attributes"><div class="versions-container">version(Postprocessors)</div></div><tt class="highlighted"><span class="hid">Postprocessor</span>[]</tt> <span class="name">postprocessors</span>;</a></div><div class="aggregate-member"><a href="dialect.parsing.IRCParser.initPostprocessors.html"><div class="conditional-compilation-attributes"><span><span class="lang-feature">version</span>(<span>Postprocessors</span>)</span><br />
</div><tt class="highlighted"><span class="type">void</span></tt> <span class="name">initPostprocessors</span>();</a></div><div class="aggregate-member"><a href="dialect.parsing.IRCParser.Update.html"><span class="builtin-type">enum</span> <span class="name">Update</span>;</a></div><div class="aggregate-member"><a href="dialect.parsing.IRCParser.updates.html"><div class="attributes"><div class="versions-container">version(FlagAsUpdated)</div></div><tt class="highlighted"><span class="hid">Update</span></tt> <span class="name">updates</span>;</a></div><div class="aggregate-member"><a href="dialect.parsing.IRCParser.clientUpdated.1.html"><div class="conditional-compilation-attributes"><span><span class="lang-feature">version</span>(<span>FlagAsUpdated</span>)</span><br />
</div><tt class="highlighted"><span class="type">bool</span></tt> <span class="name">clientUpdated</span>();</a></div><div class="aggregate-member"><a href="dialect.parsing.IRCParser.serverUpdated.1.html"><div class="conditional-compilation-attributes"><span><span class="lang-feature">version</span>(<span>FlagAsUpdated</span>)</span><br />
</div><tt class="highlighted"><span class="type">bool</span></tt> <span class="name">serverUpdated</span>();</a></div><div class="aggregate-member"><a href="dialect.parsing.IRCParser.clientUpdated.2.html"><div class="conditional-compilation-attributes"><span><span class="lang-feature">version</span>(<span>FlagAsUpdated</span>)</span><br />
</div><tt class="highlighted"><span class="type">void</span></tt> <span class="name">clientUpdated</span>(bool updated);</a></div><div class="aggregate-member"><a href="dialect.parsing.IRCParser.serverUpdated.2.html"><div class="conditional-compilation-attributes"><span><span class="lang-feature">version</span>(<span>FlagAsUpdated</span>)</span><br />
</div><tt class="highlighted"><span class="type">void</span></tt> <span class="name">serverUpdated</span>(bool updated);</a></div>}</div></div><h2 id="constructors"><a class="header-anchor" href="#constructors">Constructors</a></h2><dl class="member-list constructors"><dt><a href="dialect.parsing.IRCParser.this.1.html">this</a><div class="simplified-prototype" style="max-width: 44ch;"><span class="lang-feature name">this</span>(IRCClient client, IRCServer server)</div></dt><dd><div><p>Create a new <a class="xref" href="dialect.parsing.IRCParser.html">IRCParser</a> with the passed <a class="xref" href="dialect.defs.IRCClient.html">IRCClient</a>
            and <a class="xref" href="dialect.defs.IRCServer.html">IRCServer</a> as base context for parsing.</p></div></dd></dl><h2 id="postblit"><a class="header-anchor" href="#postblit">Postblit</a></h2><dl class="member-list"><dt><a href="dialect.parsing.IRCParser.this(this).html">this(this)</a><div class="simplified-prototype" style="max-width: 11ch;"><span class="lang-feature name">this(this)</span></div></dt><dd><div><p>Disallow copying of this struct.</p></div></dd></dl><h2 id="members"><a class="header-anchor" href="#members">Members</a></h2><h3 class="member-list-header hide-from-toc" id="enum"><a class="header-anchor" href="#enum">Enums</a></h3><dl class="member-list native"><dt><a href="dialect.parsing.IRCParser.Update.html">Update</a><div class="simplified-prototype" style="max-width: 12ch;"><span class="builtin-type">enum</span> <span class="name">Update</span></div></dt><dd><div><p>Bitfield enum of what member of an instance of <tt class="inline-code">IRCParser</tt> was
            updated (if any).</p></div></dd></dl><h3 class="member-list-header hide-from-toc" id="function"><a class="header-anchor" href="#function">Functions</a></h3><dl class="member-list native"><dt><a href="dialect.parsing.IRCParser.clientUpdated.2.html">clientUpdated</a><div class="simplified-prototype" style="max-width: 35ch;"><tt class="highlighted"><span class="type">void</span></tt> <span class="name">clientUpdated</span>(bool updated)</div></dt><dd><div><p>Wrapper for backwards compatibility with pre-bitfield update-signaling.</p></div></dd><dt><a href="dialect.parsing.IRCParser.clientUpdated.1.html">clientUpdated</a><div class="simplified-prototype" style="max-width: 22ch;"><tt class="highlighted"><span class="type">bool</span></tt> <span class="name">clientUpdated</span>()</div></dt><dd><div><p>Wrapper for backwards compatibility with pre-bitfield update-signaling.</p></div></dd><dt><a href="dialect.parsing.IRCParser.initPostprocessors.html">initPostprocessors</a><div class="simplified-prototype" style="max-width: 27ch;"><tt class="highlighted"><span class="type">void</span></tt> <span class="name">initPostprocessors</span>()</div></dt><dd><div><p>Initialises defined postprocessors.</p></div></dd><dt><a href="dialect.parsing.IRCParser.serverUpdated.1.html">serverUpdated</a><div class="simplified-prototype" style="max-width: 22ch;"><tt class="highlighted"><span class="type">bool</span></tt> <span class="name">serverUpdated</span>()</div></dt><dd><div><p>Wrapper for backwards compatibility with pre-bitfield update-signaling.</p></div></dd><dt><a href="dialect.parsing.IRCParser.serverUpdated.2.html">serverUpdated</a><div class="simplified-prototype" style="max-width: 35ch;"><tt class="highlighted"><span class="type">void</span></tt> <span class="name">serverUpdated</span>(bool updated)</div></dt><dd><div><p>Wrapper for backwards compatibility with pre-bitfield update-signaling.</p></div></dd><dt><a href="dialect.parsing.IRCParser.toIRCEvent.html">toIRCEvent</a><div class="simplified-prototype" style="max-width: 30ch;"><span class="lang-feature">auto</span>  <span class="name">toIRCEvent</span>(string raw)</div></dt><dd><div><p>Parses an IRC string into an <a class="xref" href="dialect.defs.IRCEvent.html">IRCEvent</a>.</p></div></dd></dl><h3 class="member-list-header hide-from-toc" id="variable"><a class="header-anchor" href="#variable">Variables</a></h3><dl class="member-list native"><dt><a href="dialect.parsing.IRCParser.client.html">client</a><div class="simplified-prototype" style="max-width: 18ch;"><tt class="highlighted"><span class="hid">IRCClient</span></tt> <span class="name">client</span>;</div></dt><dd><div><p>The current <a class="xref" href="dialect.defs.IRCClient.html">IRCClient</a> with all the context
        needed for parsing.</p></div></dd><dt><a href="dialect.parsing.IRCParser.postprocessors.html">postprocessors</a><div class="simplified-prototype" style="max-width: 34ch;"><tt class="highlighted"><span class="hid">Postprocessor</span>[]</tt> <span class="name">postprocessors</span>;</div></dt><dd><div><p>Array of active <a class="xref" href="dialect.common.Postprocessor.html">Postprocessor</a>s, to be
            iterated through and processed after parsing is complete.</p></div></dd><dt><a href="dialect.parsing.IRCParser.server.html">server</a><div class="simplified-prototype" style="max-width: 18ch;"><tt class="highlighted"><span class="hid">IRCServer</span></tt> <span class="name">server</span>;</div></dt><dd><div><p>The current <a class="xref" href="dialect.defs.IRCServer.html">IRCServer</a> with all the context
        needed for parsing.</p></div></dd><dt><a href="dialect.parsing.IRCParser.typenums.html">typenums</a><div class="simplified-prototype" style="max-width: 31ch;"><tt class="highlighted"><span class="hid">IRCEvent</span>.<span class="hid">Type</span>[<span class="num">1024</span>]</tt> <span class="name">typenums</span>;</div></dt><dd><div><p>An <tt class="inline-code">dialect.defs.IRCEvent.Type[1024]</tt> reverse lookup table for fast
        numeric lookups.</p></div></dd><dt><a href="dialect.parsing.IRCParser.updates.html">updates</a><div class="simplified-prototype" style="max-width: 16ch;"><tt class="highlighted"><span class="hid">Update</span></tt> <span class="name">updates</span>;</div></dt><dd><div><p>Bitfield of in what way the parser's internal state was altered
            during parsing.</p></div></dd></dl><div><h2 id="examples"><a class="header-anchor" href="#examples">Examples</a></h2><div class="documentation-comment"><div><pre class="d_code highlighted"><span class="hid">IRCClient</span> <span class="hid">client</span>;
<span class="hid">client</span>.<span class="hid">nickname</span> = <span class="str">&quot;...&quot;</span>;

<span class="hid">IRCServer</span> <span class="hid">server</span>;
<span class="hid">server</span>.<span class="hid">address</span> = <span class="str">&quot;...&quot;</span>;

<span class="hid">IRCParser</span> <span class="hid">parser</span> = <span class="hid">IRCParser</span>(<span class="hid">client</span>, <span class="hid">server</span>);

<span class="type">string</span> <span class="hid">fromServer</span> = <span class="str">&quot;:zorael!~NaN@address.tld MODE #channel +v nickname&quot;</span>;
<span class="hid">IRCEvent</span> <span class="hid">event</span> = <span class="hid">parser</span>.<span class="hid">toIRCEvent</span>(<span class="hid">fromServer</span>);

<span class="kwrd">with</span> (<span class="hid">event</span>)
{
    <span class="kwrd">assert</span>(<span class="hid">type</span> == <span class="hid">IRCEvent</span>.<span class="hid">Type</span>.<span class="hid">MODE</span>);
    <span class="kwrd">assert</span>(<span class="hid">sender</span>.<span class="hid">nickname</span> == <span class="str">&quot;zorael&quot;</span>);
    <span class="kwrd">assert</span>(<span class="hid">sender</span>.<span class="hid">ident</span> == <span class="str">&quot;~NaN&quot;</span>);
    <span class="kwrd">assert</span>(<span class="hid">sender</span>.<span class="hid">address</span> == <span class="str">&quot;address.tld&quot;</span>);
    <span class="kwrd">assert</span>(<span class="hid">target</span>.<span class="hid">nickname</span> == <span class="str">&quot;nickname&quot;</span>);
    <span class="kwrd">assert</span>(<span class="hid">channel</span> == <span class="str">&quot;#channel&quot;</span>);
    <span class="kwrd">assert</span>(<span class="hid">aux</span>[<span class="num">0</span>] = <span class="str">&quot;+v&quot;</span>);
}

<span class="type">string</span> <span class="hid">alsoFromServer</span> = <span class="str">&quot;:cherryh.freenode.net 435 oldnick newnick #d :Cannot change nickname while banned on channel&quot;</span>;
<span class="hid">IRCEvent</span> <span class="hid">event2</span> = <span class="hid">parser</span>.<span class="hid">toIRCEvent</span>(<span class="hid">alsoFromServer</span>);

<span class="kwrd">with</span> (<span class="hid">event2</span>)
{
    <span class="kwrd">assert</span>(<span class="hid">type</span> == <span class="hid">IRCEvent</span>.<span class="hid">Type</span>.<span class="hid">ERR_BANONCHAN</span>);
    <span class="kwrd">assert</span>(<span class="hid">sender</span>.<span class="hid">address</span> == <span class="str">&quot;cherryh.freenode.net&quot;</span>);
    <span class="kwrd">assert</span>(<span class="hid">channel</span> == <span class="str">&quot;#d&quot;</span>);
    <span class="kwrd">assert</span>(<span class="hid">target</span>.<span class="hid">nickname</span> == <span class="str">&quot;oldnick&quot;</span>);
    <span class="kwrd">assert</span>(<span class="hid">content</span> == <span class="str">&quot;Cannot change nickname while banned on channel&quot;</span>);
    <span class="kwrd">assert</span>(<span class="hid">aux</span>[<span class="num">0</span>] == <span class="str">&quot;newnick&quot;</span>);
    <span class="kwrd">assert</span>(<span class="hid">num</span> == <span class="num">435</span>);
}

<span class="com">// Requires Twitch support via build configuration &quot;twitch&quot;</span>
<span class="type">string</span> <span class="hid">fullExample</span> = <span class="str">&quot;@badge-info=subscriber/15;badges=subscriber/12;color=;display-name=SomeoneOnTwitch;emotes=;flags=;id=d6729804-2bf3-495d-80ce-a2fe8ed00a26;login=someoneontwitch;mod=0;msg-id=submysterygift;msg-param-mass-gift-count=1;msg-param-origin-id=49\\s9d\\s3e\\s68\\sca\\s26\\se9\\s2a\\s6e\\s44\\sd4\\s60\\s9b\\s3d\\saa\\sb9\\s4c\\sad\\s43\\s5c;msg-param-sender-count=4;msg-param-sub-plan=1000;room-id=71092938;subscriber=1;system-msg=someoneOnTwitch\\sis\\sgifting\\s1\\sTier\\s1\\sSubs\\sto\\sxQcOW's\\scommunity!\\sThey've\\sgifted\\sa\\stotal\\sof\\s4\\sin\\sthe\\schannel!;tmi-sent-ts=1569013433362;user-id=224578549;user-type= :tmi.twitch.tv USERNOTICE #xqcow&quot;</span>
<span class="hid">IRCEvent</span> <span class="hid">event4</span> = <span class="hid">parser</span>.<span class="hid">toIRCEvent</span>(<span class="hid">fullExample</span>);

<span class="kwrd">with</span> (<span class="hid">event</span>)
{
    <span class="kwrd">assert</span>(<span class="hid">type</span> == <span class="hid">IRCEvent</span>.<span class="hid">Type</span>.<span class="hid">TWITCH_BULKGIFT</span>);
    <span class="kwrd">assert</span>(<span class="hid">sender</span>.<span class="hid">nickname</span> == <span class="str">&quot;someoneontwitch&quot;</span>);
    <span class="kwrd">assert</span>(<span class="hid">sender</span>.<span class="hid">displayName</span> == <span class="str">&quot;SomeoneOnTwitch&quot;</span>);
    <span class="kwrd">assert</span>(<span class="hid">sender</span>.<span class="hid">badges</span> == <span class="str">&quot;subscriber/12&quot;</span>);
    <span class="kwrd">assert</span>(<span class="hid">channel</span> == <span class="str">&quot;#xqcow&quot;</span>);
    <span class="kwrd">assert</span>(<span class="hid">content</span> == <span class="str">&quot;SomeoneOnTwitch is gifting 1 Tier 1 Subs to xQcOW's community! They've gifted a total of 4 in the channel!&quot;</span>);
    <span class="kwrd">assert</span>(<span class="hid">aux</span>[<span class="num">0</span>] == <span class="str">&quot;1000&quot;</span>);
    <span class="kwrd">assert</span>(<span class="hid">count</span>[<span class="num">0</span>] == <span class="num">1</span>);
    <span class="kwrd">assert</span>(<span class="hid">count</span>[<span class="num">1</span>] == <span class="num">4</span>);
}</pre></div></div><div class="unittest-example-holder"><div class="documentation-comment"></div><pre class="d_code highlighted"><span class="kwrd">import</span> <span class="hid">lu</span>.<span class="hid">meld</span> : <span class="hid">MeldingStrategy</span>, <span class="hid">meldInto</span>;

<span class="hid">IRCParser</span> <span class="hid">parser</span>;

<span class="kwrd">alias</span> <span class="hid">T</span> = <span class="hid">IRCEvent</span>.<span class="hid">Type</span>;

<span class="hid">parser</span>.<span class="hid">typenums</span> = <span class="hid">Typenums</span>.<span class="hid">base</span>;

<span class="kwrd">assert</span>(<span class="hid">parser</span>.<span class="hid">typenums</span>[<span class="num">344</span>] == <span class="hid">T</span>.<span class="hid">init</span>);
<span class="hid">Typenums</span>.<span class="hid">hybrid</span>[].<span class="hid">meldInto</span>!(<span class="hid">MeldingStrategy</span>.<span class="hid">aggressive</span>)(<span class="hid">parser</span>.<span class="hid">typenums</span>);
<span class="kwrd">assert</span>(<span class="hid">parser</span>.<span class="hid">typenums</span>[<span class="num">344</span>] != <span class="hid">T</span>.<span class="hid">init</span>);</pre></div></div></div>
		<div id="page-nav"><a class="parent" href="dialect.html">dialect</a> <a class="parent" href="dialect.parsing.html">parsing</a> 
		<span class="type-separator">functions</span><ul><li><a class="function" href="dialect.parsing.applyTags.html">applyTags</a></li><li><a class="function" href="dialect.parsing.onISUPPORT.html">onISUPPORT</a></li><li><a class="function" href="dialect.parsing.onMode.html">onMode</a></li><li><a class="function" href="dialect.parsing.onMyInfo.html">onMyInfo</a></li><li><a class="function" href="dialect.parsing.onNotice.html">onNotice</a></li><li><a class="function" href="dialect.parsing.onPRIVMSG.html">onPRIVMSG</a></li><li><a class="function" href="dialect.parsing.parseBasic.html">parseBasic</a></li><li><a class="function" href="dialect.parsing.parseGeneralCases.html">parseGeneralCases</a></li><li><a class="function" href="dialect.parsing.parsePrefix.html">parsePrefix</a></li><li><a class="function" href="dialect.parsing.parseSpecialcases.html">parseSpecialcases</a></li><li><a class="function" href="dialect.parsing.parseTypestring.html">parseTypestring</a></li><li><a class="function" href="dialect.parsing.postparseSanityCheck.html">postparseSanityCheck</a></li><li><a class="function" href="dialect.parsing.toIRCEvent.html">toIRCEvent</a></li></ul><span class="type-separator">structs</span><ul><li><a class="struct current" href="dialect.parsing.IRCParser.html">IRCParser</a></li></ul></div>
	</div>
	<div id="page-footer">Page generated by <a href="https://github.com/adamdruppe/adrdox">adrdox</a></div>
</body>
</html>