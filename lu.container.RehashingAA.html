<!DOCTYPE html>
<html lang="en">
<head>
        <title>RehashingAA (lu.container.RehashingAA)</title>
	<meta charset="utf-8" />
	<meta content="width=device-width, initial-scale=1" name="viewport" />
        <link href="style.css" rel="stylesheet" />
        <script src="script.js" type="text/javascript"></script>

	
	<link href="search-results.html" rel="prefetch" />
</head>
<body>
	<div id="page-header">
		<div id="logotype">
		<span>kameloso IRC bot</span>
		<nav>
			<a href="http://dlang.org/">Dlang.org</a>
		</nav>
		</div>

		<form action="search-docs.html" id="search">
			<input name="searchTerm" placeholder="Find a symbol name..." type="search" />
			<input type="submit" value="Go" />
		</form>
	</div>
	<div id="page-body">
		<div id="page-content">
		<h1>RehashingAA</h1><div class="breadcrumbs"><a class="breadcrumb" href="lu.html">lu</a> <a class="breadcrumb" href="lu.container.html">container</a> </div><div><div class="documentation-comment synopsis"><div><p>A wrapper around a native associative array that you can controllably set to
    automatically rehash as entries are added.</p></div></div></div><div class="annotated-prototype"><div class="aggregate-prototype"><div class="attributes"></div><span class="builtin-type">struct</span> RehashingAA (<div class="parameters-list toplevel"><div class="template-parameter-item parameter-item">	<span><span class="name" data-ident="AA">AA</span> : <span class="name" data-ident="V">V</span>[<span class="name" data-ident="K">K</span>]</span></div><div class="template-parameter-item parameter-item">	<span><span class="name" data-ident="V">V</span></span></div><div class="template-parameter-item parameter-item">	<span><span class="name" data-ident="K">K</span></span></div></div>) {<div class="aggregate-member"><a href="lu.container.RehashingAA.aa.html"><div class="attributes">private </div><tt class="highlighted"><span class="hid">AA</span></tt> <span class="name">aa</span>;</a></div><div class="aggregate-member"><a href="lu.container.RehashingAA._numRehashes.html"><div class="attributes">private </div><tt class="highlighted"><span class="type">uint</span></tt> <span class="name">_numRehashes</span>;</a></div><div class="aggregate-member"><a href="lu.container.RehashingAA._newKeysSinceLastRehash.html"><div class="attributes">private </div><tt class="highlighted"><span class="type">uint</span></tt> <span class="name">_newKeysSinceLastRehash</span>;</a></div><div class="aggregate-member"><a href="lu.container.RehashingAA._lengthAtLastRehash.html"><div class="attributes">private </div><tt class="highlighted"><span class="hid">size_t</span></tt> <span class="name">_lengthAtLastRehash</span>;</a></div><div class="aggregate-member"><a href="lu.container.RehashingAA.minimumNeededForRehash.html"><div class="attributes"></div><tt class="highlighted"><span class="type">uint</span></tt> <span class="name">minimumNeededForRehash</span>;</a></div><div class="aggregate-member"><a href="lu.container.RehashingAA.rehashThresholdMultiplier.html"><div class="attributes"></div><tt class="highlighted"><span class="type">double</span></tt> <span class="name">rehashThresholdMultiplier</span>;</a></div><div class="aggregate-member"><a href="lu.container.RehashingAA.opIndexAssign.html"><tt class="highlighted"><span class="type">void</span></tt> <span class="name">opIndexAssign</span>(V value, K key);</a></div><div class="aggregate-member"><a href="lu.container.RehashingAA.opIndex.html"><span class="lang-feature">auto ref</span>  <span class="name">opIndex</span>(K key);</a></div><div class="aggregate-member"><a href="lu.container.RehashingAA.opIndexUnary.html"><span class="lang-feature">auto ref</span>  <span class="name">opIndexUnary</span>(K key);</a></div><div class="aggregate-member"><a href="lu.container.RehashingAA.opAssign.html"><tt class="highlighted"><span class="type">void</span></tt> <span class="name">opAssign</span>(V[K] aa);</a></div><div class="aggregate-member"><a href="lu.container.RehashingAA.opIndexOpAssign.html"><tt class="highlighted"><span class="type">void</span></tt> <span class="name">opIndexOpAssign</span>(U value, K key);</a></div><div class="aggregate-member"><a href="lu.container.RehashingAA.opCast.html"><span class="lang-feature">auto ref</span>  <span class="name">opCast</span>();</a></div><div class="aggregate-member"><a href="lu.container.RehashingAA.aaOf.html"><span class="lang-feature">auto ref</span>  <span class="name">aaOf</span>();</a></div><div class="aggregate-member"><a href="lu.container.RehashingAA.remove.html"><span class="lang-feature">auto</span>  <span class="name">remove</span>(K key);</a></div><div class="aggregate-member"><a href="lu.container.RehashingAA.maybeRehash.html"><span class="lang-feature">auto</span>  <span class="name">maybeRehash</span>();</a></div><div class="aggregate-member"><a href="lu.container.RehashingAA.clear.html"><tt class="highlighted"><span class="type">void</span></tt> <span class="name">clear</span>();</a></div><div class="aggregate-member"><a href="lu.container.RehashingAA.rehash.html"><span class="lang-feature">auto ref</span>  <span class="name">rehash</span>();</a></div><div class="aggregate-member"><a href="lu.container.RehashingAA.numRehashes.html"><span class="lang-feature">auto</span>  <span class="name">numRehashes</span>();</a></div><div class="aggregate-member"><a href="lu.container.RehashingAA.newKeysSinceLastRehash.html"><span class="lang-feature">auto</span>  <span class="name">newKeysSinceLastRehash</span>();</a></div><div class="aggregate-member"><a href="lu.container.RehashingAA.opBinaryRight.html"><span class="lang-feature">auto</span>  <span class="name">opBinaryRight</span>(K key);</a></div><div class="aggregate-member"><a href="lu.container.RehashingAA.byValue.html"><span class="lang-feature">auto</span>  <span class="name">byValue</span>();</a></div><div class="aggregate-member"><a href="lu.container.RehashingAA.byKey.html"><span class="lang-feature">auto</span>  <span class="name">byKey</span>();</a></div><div class="aggregate-member"><a href="lu.container.RehashingAA.values.html"><span class="lang-feature">auto</span>  <span class="name">values</span>();</a></div><div class="aggregate-member"><a href="lu.container.RehashingAA.keys.html"><span class="lang-feature">auto</span>  <span class="name">keys</span>();</a></div><div class="aggregate-member"><a href="lu.container.RehashingAA.byKeyValue.html"><span class="lang-feature">auto</span>  <span class="name">byKeyValue</span>();</a></div><div class="aggregate-member"><a href="lu.container.RehashingAA.length.html"><span class="lang-feature">auto</span>  <span class="name">length</span>();</a></div><div class="aggregate-member"><a href="lu.container.RehashingAA.dup.html"><span class="lang-feature">auto</span>  <span class="name">dup</span>(bool copyState);</a></div><div class="aggregate-member"><a href="lu.container.RehashingAA.require.html"><span class="lang-feature">auto ref</span>  <span class="name">require</span>(K key, V value);</a></div><div class="aggregate-member"><a href="lu.container.RehashingAA.get.html"><span class="lang-feature">auto ref</span>  <span class="name">get</span>(K key, V value);</a></div><div class="aggregate-member"><a href="lu.container.RehashingAA.uniqueKey.html"><div class="conditional-compilation-attributes"><span><span class="lang-feature">static if</span>(<span>isIntegral!K</span>)</span><br />
</div><span class="lang-feature">auto</span>  <span class="name">uniqueKey</span>(K min, K max, V value);</a></div><div class="aggregate-member"><a href="lu.container.RehashingAA.update.html"><tt class="highlighted"><span class="type">void</span></tt> <span class="name">update</span>(K key, V delegate() createDg, U delegate(K) updateDg);</a></div><div class="aggregate-member"><a href="lu.container.RehashingAA.opEquals.1.html"><span class="lang-feature">auto</span>  <span class="name">opEquals</span>(typeof(this) other);</a></div><div class="aggregate-member"><a href="lu.container.RehashingAA.opEquals.2.html"><span class="lang-feature">auto</span>  <span class="name">opEquals</span>(AA other);</a></div><div class="aggregate-member"><a href="lu.container.RehashingAA.this.html"><span class="lang-feature name">this</span>(AA aa);</a></div><div class="aggregate-member"><a href="lu.container.RehashingAA.onRehashDg.html"><div class="attributes"></div><tt class="highlighted"><span class="type">void</span> <span class="kwrd">delegate</span>(<span class="kwrd">ref</span> <span class="hid">AA</span>) @(<span class="hid">system</span>)</tt> <span class="name">onRehashDg</span>;</a></div>}</div></div><h2 id="constructors"><a class="header-anchor" href="#constructors">Constructors</a></h2><dl class="member-list constructors"><dt><a href="lu.container.RehashingAA.this.html">this</a><div class="simplified-prototype" style="max-width: 12ch;"><span class="lang-feature name">this</span>(AA aa)</div></dt><dd><div><p>Constructor.</p></div></dd></dl><h2 id="members"><a class="header-anchor" href="#members">Members</a></h2><h3 class="member-list-header hide-from-toc" id="function"><a class="header-anchor" href="#function">Functions</a></h3><dl class="member-list native"><dt><a href="lu.container.RehashingAA.aaOf.html">aaOf</a><div class="simplified-prototype" style="max-width: 17ch;"><span class="lang-feature">auto ref</span>  <span class="name">aaOf</span>()</div></dt><dd><div><p>Returns the internal associative array, for when the wrapper is insufficient.</p></div></dd><dt><a href="lu.container.RehashingAA.byKey.html">byKey</a><div class="simplified-prototype" style="max-width: 14ch;"><span class="lang-feature">auto</span>  <span class="name">byKey</span>()</div></dt><dd><div><p>Wraps the internal associative array's <tt class="inline-code">byKey</tt> function.</p></div></dd><dt><a href="lu.container.RehashingAA.byKeyValue.html">byKeyValue</a><div class="simplified-prototype" style="max-width: 19ch;"><span class="lang-feature">auto</span>  <span class="name">byKeyValue</span>()</div></dt><dd><div><p>Wraps the internal associative array's <tt class="inline-code">byKeyValue</tt> function.</p></div></dd><dt><a href="lu.container.RehashingAA.byValue.html">byValue</a><div class="simplified-prototype" style="max-width: 16ch;"><span class="lang-feature">auto</span>  <span class="name">byValue</span>()</div></dt><dd><div><p>Wraps the internal associative array's <tt class="inline-code">byValue</tt> function.</p></div></dd><dt><a href="lu.container.RehashingAA.clear.html">clear</a><div class="simplified-prototype" style="max-width: 13ch;"><tt class="highlighted"><span class="type">void</span></tt> <span class="name">clear</span>()</div></dt><dd><div><p>Clears the internal associative array and all counters.</p></div></dd><dt><a href="lu.container.RehashingAA.dup.html">dup</a><div class="simplified-prototype" style="max-width: 27ch;"><span class="lang-feature">auto</span>  <span class="name">dup</span>(bool copyState)</div></dt><dd><div><p>Duplicates this. Explicitly copies the internal associative array.</p></div></dd><dt><a href="lu.container.RehashingAA.get.html">get</a><div class="simplified-prototype" style="max-width: 31ch;"><span class="lang-feature">auto ref</span>  <span class="name">get</span>(K key, V value)</div></dt><dd><div><p>Retrieves the value for the key <tt class="inline-code">key</tt>, or returns the default <tt class="inline-code">value</tt>
        if there was none.</p></div></dd><dt><a href="lu.container.RehashingAA.keys.html">keys</a><div class="simplified-prototype" style="max-width: 13ch;"><span class="lang-feature">auto</span>  <span class="name">keys</span>()</div></dt><dd><div><p>Wraps the internal associative array's <tt class="inline-code">keys</tt> function.</p></div></dd><dt><a href="lu.container.RehashingAA.length.html">length</a><div class="simplified-prototype" style="max-width: 15ch;"><span class="lang-feature">auto</span>  <span class="name">length</span>()</div></dt><dd><div><p>Returns the length of the internal associative array.</p></div></dd><dt><a href="lu.container.RehashingAA.maybeRehash.html">maybeRehash</a><div class="simplified-prototype" style="max-width: 20ch;"><span class="lang-feature">auto</span>  <span class="name">maybeRehash</span>()</div></dt><dd><div><p>Bumps the internal counter of new keys since the last rehash, and depending
        on the resulting value of it, maybe rehashes.</p></div></dd><dt><a href="lu.container.RehashingAA.newKeysSinceLastRehash.html">newKeysSinceLastRehash</a><div class="simplified-prototype" style="max-width: 33ch;"><span class="lang-feature">auto</span>  <span class="name">newKeysSinceLastRehash</span>()</div></dt><dd><div><p>The number of new entries that has been added since the last rehash. Accessor.</p></div></dd><dt><a href="lu.container.RehashingAA.numRehashes.html">numRehashes</a><div class="simplified-prototype" style="max-width: 20ch;"><span class="lang-feature">auto</span>  <span class="name">numRehashes</span>()</div></dt><dd><div><p>The number of times this instance has rehashed itself. Accessor.</p></div></dd><dt><a href="lu.container.RehashingAA.opAssign.html">opAssign</a><div class="simplified-prototype" style="max-width: 24ch;"><tt class="highlighted"><span class="type">void</span></tt> <span class="name">opAssign</span>(V[K] aa)</div></dt><dd><div><p>Inherit a native associative array into <a class="xref" href="lu.container.RehashingAA.aa.html">aa</a>.</p></div></dd><dt><a href="lu.container.RehashingAA.opBinaryRight.html">opBinaryRight</a><div class="simplified-prototype" style="max-width: 28ch;"><span class="lang-feature">auto</span>  <span class="name">opBinaryRight</span>(K key)</div></dt><dd><div><p>Wraps <tt class="inline-code">key in aa</tt> to the internal associative array.</p></div></dd><dt><a href="lu.container.RehashingAA.opCast.html">opCast</a><div class="simplified-prototype" style="max-width: 19ch;"><span class="lang-feature">auto ref</span>  <span class="name">opCast</span>()</div></dt><dd><div><p>Allows for casting this into the base associative array type.</p></div></dd><dt><a href="lu.container.RehashingAA.opEquals.1.html">opEquals</a><div class="simplified-prototype" style="max-width: 37ch;"><span class="lang-feature">auto</span>  <span class="name">opEquals</span>(typeof(this) other)</div></dt><dd><div><p>Implements <tt class="inline-code">opEquals</tt> for this type, comparing the internal associative
        array with that of another <tt class="inline-code">RehashingAA</tt>.</p></div></dd><dt><a href="lu.container.RehashingAA.opEquals.2.html">opEquals</a><div class="simplified-prototype" style="max-width: 26ch;"><span class="lang-feature">auto</span>  <span class="name">opEquals</span>(AA other)</div></dt><dd><div><p>Implements <tt class="inline-code">opEquals</tt> for this type, comparing the internal associative
        array with a different one.</p></div></dd><dt><a href="lu.container.RehashingAA.opIndex.html">opIndex</a><div class="simplified-prototype" style="max-width: 26ch;"><span class="lang-feature">auto ref</span>  <span class="name">opIndex</span>(K key)</div></dt><dd><div><p>Returns the value for the passed key in the internal associative array.</p></div></dd><dt><a href="lu.container.RehashingAA.opIndexAssign.html">opIndexAssign</a><div class="simplified-prototype" style="max-width: 37ch;"><tt class="highlighted"><span class="type">void</span></tt> <span class="name">opIndexAssign</span>(V value, K key)</div></dt><dd><div><p>Assigns a value into the internal associative array. If it created a new
        entry, then call <a class="xref" href="lu.container.RehashingAA.maybeRehash.html">maybeRehash</a> to bump the internal counter and maybe rehash.</p></div></dd><dt><a href="lu.container.RehashingAA.opIndexOpAssign.html">opIndexOpAssign</a><div class="simplified-prototype" style="max-width: 39ch;"><tt class="highlighted"><span class="type">void</span></tt> <span class="name">opIndexOpAssign</span>(U value, K key)</div></dt><dd><div><p>Performs an assignment operation on a value in the internal associative array.</p></div></dd><dt><a href="lu.container.RehashingAA.opIndexUnary.html">opIndexUnary</a><div class="simplified-prototype" style="max-width: 31ch;"><span class="lang-feature">auto ref</span>  <span class="name">opIndexUnary</span>(K key)</div></dt><dd><div><p>Performs a unary operation on a value in the internal associative array.</p></div></dd><dt><a href="lu.container.RehashingAA.rehash.html">rehash</a><div class="simplified-prototype" style="max-width: 19ch;"><span class="lang-feature">auto ref</span>  <span class="name">rehash</span>()</div></dt><dd><div><p>Rehashes the internal associative array, bumping the rehash counter and
        zeroing the keys-added counter. Additionally invokes the <a class="xref" href="lu.container.RehashingAA.onRehashDg.html">onRehashDg</a> delegate.</p></div></dd><dt><a href="lu.container.RehashingAA.remove.html">remove</a><div class="simplified-prototype" style="max-width: 20ch;"><span class="lang-feature">auto</span>  <span class="name">remove</span>(K key)</div></dt><dd><div><p>Removes a key from the <a class="xref" href="lu.container.RehashingAA.aa.html">aa</a> associative array by merely
        invoking <tt class="inline-code">.remove</tt>.</p></div></dd><dt><a href="lu.container.RehashingAA.require.html">require</a><div class="simplified-prototype" style="max-width: 36ch;"><span class="lang-feature">auto ref</span>  <span class="name">require</span>(K key, V value)</div></dt><dd><div><p>Returns the value for the key <tt class="inline-code">key</tt>, inserting <tt class="inline-code">value</tt> lazily if it is not present.</p></div></dd><dt><a href="lu.container.RehashingAA.uniqueKey.html">uniqueKey</a><div class="simplified-prototype" style="max-width: 41ch;"><span class="lang-feature">auto</span>  <span class="name">uniqueKey</span>(K min, K max, V value)</div></dt><dd><div><p>Reserves a unique key in the associative array.</p></div></dd><dt><a href="lu.container.RehashingAA.update.html">update</a><div class="simplified-prototype" style="max-width: 71ch;"><tt class="highlighted"><span class="type">void</span></tt> <span class="name">update</span>(K key, V delegate() createDg, U delegate(K) updateDg)</div></dt><dd><div><p>Updates the value for the key <tt class="inline-code">key</tt> in the internal associative array,
        invoking the first of the passed delegate to insert a new value if it
        doesn't exist, or the second selegate to modify it in place if it does.</p></div></dd><dt><a href="lu.container.RehashingAA.values.html">values</a><div class="simplified-prototype" style="max-width: 15ch;"><span class="lang-feature">auto</span>  <span class="name">values</span>()</div></dt><dd><div><p>Wraps the internal associative array's <tt class="inline-code">values</tt> function.</p></div></dd></dl><h3 class="member-list-header hide-from-toc" id="variable"><a class="header-anchor" href="#variable">Variables</a></h3><dl class="member-list native"><dt><a href="lu.container.RehashingAA._lengthAtLastRehash.html">_lengthAtLastRehash</a><div class="simplified-prototype" style="max-width: 29ch;"><tt class="highlighted"><span class="hid">size_t</span></tt> <span class="name">_lengthAtLastRehash</span>;</div></dt><dd><div><p>The number of keys (and length of the array) when the last rehash took place.
        Private value.</p></div></dd><dt><a href="lu.container.RehashingAA._newKeysSinceLastRehash.html">_newKeysSinceLastRehash</a><div class="simplified-prototype" style="max-width: 31ch;"><tt class="highlighted"><span class="type">uint</span></tt> <span class="name">_newKeysSinceLastRehash</span>;</div></dt><dd><div><p>The number of new entries that has been added since the last rehash. Private value.</p></div></dd><dt><a href="lu.container.RehashingAA._numRehashes.html">_numRehashes</a><div class="simplified-prototype" style="max-width: 19ch;"><tt class="highlighted"><span class="type">uint</span></tt> <span class="name">_numRehashes</span>;</div></dt><dd><div><p>The number of times this instance has rehashed itself. Private value.</p></div></dd><dt><a href="lu.container.RehashingAA.aa.html">aa</a><div class="simplified-prototype" style="max-width: 6ch;"><tt class="highlighted"><span class="hid">AA</span></tt> <span class="name">aa</span>;</div></dt><dd><div><p>Internal associative array.</p></div></dd><dt><a href="lu.container.RehashingAA.minimumNeededForRehash.html">minimumNeededForRehash</a><div class="simplified-prototype" style="max-width: 30ch;"><tt class="highlighted"><span class="type">uint</span></tt> <span class="name">minimumNeededForRehash</span>;</div></dt><dd><div><p>The minimum number of additions needed before the first rehash takes place.</p></div></dd><dt><a href="lu.container.RehashingAA.onRehashDg.html">onRehashDg</a><div class="simplified-prototype" style="max-width: 47ch;"><tt class="highlighted"><span class="type">void</span> <span class="kwrd">delegate</span>(<span class="kwrd">ref</span> <span class="hid">AA</span>) @(<span class="hid">system</span>)</tt> <span class="name">onRehashDg</span>;</div></dt><dd><div><p>Delegate called when rehashing takes place.</p></div></dd><dt><a href="lu.container.RehashingAA.rehashThresholdMultiplier.html">rehashThresholdMultiplier</a><div class="simplified-prototype" style="max-width: 36ch;"><tt class="highlighted"><span class="type">double</span></tt> <span class="name">rehashThresholdMultiplier</span>;</div></dt><dd><div><p>The modifier by how much more entries must be added before another rehash
        takes place, with regards to the current <a class="xref" href="lu.container.RehashingAA.aa.html">aa</a> length.</p></div></dd></dl><div><h2 id="parameters"><a class="header-anchor" href="#parameters">Parameters</a></h2><dl class="parameter-descriptions"><dt id="param-AA"><a class="parameter-name" data-ident="AA" href="#param-AA">AA</a></dt><dd><div class="documentation-comment"><div><p>Associative array type.</p></div></div></dd><dt id="param-V"><a class="parameter-name" data-ident="V" href="#param-V">V</a></dt><dd><div class="documentation-comment"><div><p>Value type.</p></div></div></dd><dt id="param-K"><a class="parameter-name" data-ident="K" href="#param-K">K</a></dt><dd><div class="documentation-comment"><div><p>Key type.</p></div></div></dd></dl><h2 id="examples"><a class="header-anchor" href="#examples">Examples</a></h2><div class="documentation-comment"><div></div></div><div class="unittest-example-holder"><div class="documentation-comment"></div><pre class="d_code highlighted with-line-wrappers"><span class="br">1 </span><span class="kwrd">import</span> <span class="hid">std</span>.<span class="hid">conv</span> : <span class="hid">to</span>;
<span class="br">2 </span>
<span class="br">3 </span>{
<span class="br">4 </span>    <span class="type">uint</span> <span class="hid">counter</span>;
<span class="br">5 </span>
<span class="br">6 </span>    <span class="type">void</span> <span class="hid">dg</span>(<span class="kwrd">ref</span> <span class="type">int</span>[<span class="type">string</span>] <span class="hid">aa</span>)
<span class="br">7 </span>    {
<span class="br">8 </span>        ++<span class="hid">counter</span>;
<span class="br">9 </span>    }
<span class="br">10 </span>
<span class="br">11 </span>    <span class="hid">RehashingAA</span>!(<span class="type">int</span>[<span class="type">string</span>]) <span class="hid">aa</span>;
<span class="br">12 </span>    <span class="hid">aa</span>.<span class="hid">onRehashDg</span> = &amp;<span class="hid">dg</span>;
<span class="br">13 </span>    <span class="hid">aa</span>.<span class="hid">minimumNeededForRehash</span> = <span class="num">2</span>;
<span class="br">14 </span>
<span class="br">15 </span>    <span class="hid">aa</span>[<span class="str">&quot;abc&quot;</span>] = <span class="num">123</span>;
<span class="br">16 </span>    <span class="hid">aa</span>[<span class="str">&quot;def&quot;</span>] = <span class="num">456</span>;
<span class="br">17 </span>    <span class="kwrd">assert</span>((<span class="hid">aa</span>.<span class="hid">newKeysSinceLastRehash</span> == <span class="num">2</span>), <span class="hid">aa</span>.<span class="hid">newKeysSinceLastRehash</span>.<span class="hid">to</span>!<span class="type">string</span>);
<span class="br">18 </span>    <span class="kwrd">assert</span>((<span class="hid">aa</span>.<span class="hid">numRehashes</span> == <span class="num">0</span>), <span class="hid">aa</span>.<span class="hid">numRehashes</span>.<span class="hid">to</span>!<span class="type">string</span>);
<span class="br">19 </span>    <span class="hid">aa</span>[<span class="str">&quot;ghi&quot;</span>] = <span class="num">789</span>;
<span class="br">20 </span>    <span class="kwrd">assert</span>((<span class="hid">aa</span>.<span class="hid">numRehashes</span> == <span class="num">1</span>), <span class="hid">aa</span>.<span class="hid">numRehashes</span>.<span class="hid">to</span>!<span class="type">string</span>);
<span class="br">21 </span>    <span class="kwrd">assert</span>((<span class="hid">aa</span>.<span class="hid">newKeysSinceLastRehash</span> == <span class="num">0</span>), <span class="hid">aa</span>.<span class="hid">newKeysSinceLastRehash</span>.<span class="hid">to</span>!<span class="type">string</span>);
<span class="br">22 </span>    <span class="hid">aa</span>.<span class="hid">rehash</span>();
<span class="br">23 </span>    <span class="kwrd">assert</span>((<span class="hid">aa</span>.<span class="hid">numRehashes</span> == <span class="num">2</span>), <span class="hid">aa</span>.<span class="hid">numRehashes</span>.<span class="hid">to</span>!<span class="type">string</span>);
<span class="br">24 </span>    <span class="kwrd">assert</span>((<span class="hid">counter</span> == <span class="num">2</span>), <span class="hid">counter</span>.<span class="hid">to</span>!<span class="type">string</span>);
<span class="br">25 </span>
<span class="br">26 </span>    <span class="kwrd">auto</span> <span class="hid">realAA</span> = <span class="kwrd">cast</span>(<span class="type">int</span>[<span class="type">string</span>])<span class="hid">aa</span>;
<span class="br">27 </span>    <span class="kwrd">assert</span>(<span class="str">&quot;abc&quot;</span> <span class="kwrd">in</span> <span class="hid">realAA</span>);
<span class="br">28 </span>    <span class="kwrd">assert</span>(<span class="str">&quot;def&quot;</span> <span class="kwrd">in</span> <span class="hid">realAA</span>);
<span class="br">29 </span>
<span class="br">30 </span>    <span class="kwrd">auto</span> <span class="hid">alsoRealAA</span> = <span class="hid">aa</span>.<span class="hid">aaOf</span>;
<span class="br">31 </span>    <span class="kwrd">assert</span>(<span class="str">&quot;ghi&quot;</span> <span class="kwrd">in</span> <span class="hid">alsoRealAA</span>);
<span class="br">32 </span>    <span class="kwrd">assert</span>(<span class="str">&quot;jkl&quot;</span> !<span class="kwrd">in</span> <span class="hid">alsoRealAA</span>);
<span class="br">33 </span>
<span class="br">34 </span>    <span class="kwrd">auto</span> <span class="hid">aa2</span> = <span class="hid">aa</span>.<span class="hid">dup</span>(<span class="hid">copyState</span>: <span class="kwrd">true</span>);
<span class="br">35 </span>    <span class="kwrd">assert</span>((<span class="hid">aa2</span>.<span class="hid">numRehashes</span> == <span class="num">2</span>), <span class="hid">aa2</span>.<span class="hid">numRehashes</span>.<span class="hid">to</span>!<span class="type">string</span>);
<span class="br">36 </span>    <span class="hid">aa2</span>[<span class="str">&quot;jkl&quot;</span>] = <span class="num">123</span>;
<span class="br">37 </span>    <span class="kwrd">assert</span>(<span class="str">&quot;jkl&quot;</span> <span class="kwrd">in</span> <span class="hid">aa2</span>);
<span class="br">38 </span>    <span class="kwrd">assert</span>(<span class="str">&quot;jkl&quot;</span> !<span class="kwrd">in</span> <span class="hid">aa</span>);
<span class="br">39 </span>
<span class="br">40 </span>    <span class="kwrd">auto</span> <span class="hid">aa3</span> = <span class="hid">aa</span>.<span class="hid">dup</span>();  <span class="com">//(copyState: false);</span>
<span class="br">41 </span>    <span class="kwrd">assert</span>(!<span class="hid">aa3</span>.<span class="hid">numRehashes</span>, <span class="hid">aa3</span>.<span class="hid">numRehashes</span>.<span class="hid">to</span>!<span class="type">string</span>);
<span class="br">42 </span>    <span class="kwrd">assert</span>(<span class="hid">aa3</span>.<span class="hid">aaOf</span> == <span class="hid">aa</span>.<span class="hid">aaOf</span>);
<span class="br">43 </span>    <span class="kwrd">assert</span>(<span class="hid">aa3</span>.<span class="hid">aaOf</span> !<span class="kwrd">is</span> <span class="hid">aa</span>.<span class="hid">aaOf</span>);
<span class="br">44 </span>}
<span class="br">45 </span>{
<span class="br">46 </span>    <span class="hid">RehashingAA</span>!(<span class="type">int</span>[<span class="type">int</span>]) <span class="hid">aa</span>;
<span class="br">47 </span>    <span class="hid">aa</span>[<span class="num">1</span>] = <span class="num">2</span>;
<span class="br">48 </span>    ++<span class="hid">aa</span>[<span class="num">1</span>];
<span class="br">49 </span>    <span class="kwrd">assert</span>((<span class="hid">aa</span>[<span class="num">1</span>] == <span class="num">3</span>), <span class="hid">aa</span>[<span class="num">1</span>].<span class="hid">to</span>!<span class="type">string</span>);
<span class="br">50 </span>    <span class="kwrd">assert</span>((-<span class="hid">aa</span>[<span class="num">1</span>] == -<span class="num">3</span>), (-<span class="hid">aa</span>[<span class="num">1</span>]).<span class="hid">to</span>!<span class="type">string</span>);
<span class="br">51 </span>}
<span class="br">52 </span>{
<span class="br">53 </span>    <span class="hid">RehashingAA</span>!(<span class="type">int</span>[<span class="type">int</span>]) <span class="hid">aa</span>;
<span class="br">54 </span>    <span class="hid">aa</span>[<span class="num">1</span>] = <span class="num">42</span>;
<span class="br">55 </span>    <span class="hid">aa</span>[<span class="num">1</span>] += <span class="num">1</span>;
<span class="br">56 </span>    <span class="kwrd">assert</span>(<span class="hid">aa</span>[<span class="num">1</span>] == <span class="num">43</span>);
<span class="br">57 </span>
<span class="br">58 </span>    <span class="hid">aa</span>[<span class="num">1</span>] *= <span class="num">2</span>;
<span class="br">59 </span>    <span class="kwrd">assert</span>(<span class="hid">aa</span>[<span class="num">1</span>] == <span class="num">86</span>);
<span class="br">60 </span>}
<span class="br">61 </span>{
<span class="br">62 </span>    <span class="hid">RehashingAA</span>!(<span class="type">int</span>[<span class="type">string</span>]) <span class="hid">aa</span>;
<span class="br">63 </span>    <span class="kwrd">static</span> <span class="kwrd">assert</span>(<span class="kwrd">is</span>(<span class="kwrd">typeof</span>(<span class="hid">aa</span>.<span class="hid">aaOf</span>()) == <span class="type">int</span>[<span class="type">string</span>]));
<span class="br">64 </span>
<span class="br">65 </span>    <span class="hid">aa</span>[<span class="str">&quot;abc&quot;</span>] = <span class="num">123</span>;
<span class="br">66 </span>    <span class="kwrd">auto</span> <span class="hid">native</span> = <span class="kwrd">cast</span>(<span class="type">int</span>[<span class="type">string</span>])<span class="hid">aa</span>;
<span class="br">67 </span>    <span class="kwrd">assert</span>(<span class="hid">native</span>[<span class="str">&quot;abc&quot;</span>] == <span class="num">123</span>);
<span class="br">68 </span>}
<span class="br">69 </span>{
<span class="br">70 </span>    <span class="hid">RehashingAA</span>!(<span class="type">int</span>[<span class="type">string</span>]) <span class="hid">aa</span>;
<span class="br">71 </span>    <span class="hid">aa</span>[<span class="str">&quot;abc&quot;</span>] = <span class="num">123</span>;
<span class="br">72 </span>    <span class="hid">aa</span>[<span class="str">&quot;def&quot;</span>] = <span class="num">456</span>;
<span class="br">73 </span>    <span class="kwrd">assert</span>((<span class="hid">aa</span>.<span class="hid">length</span> == <span class="num">2</span>), <span class="hid">aa</span>.<span class="hid">length</span>.<span class="hid">to</span>!<span class="type">string</span>);
<span class="br">74 </span>    <span class="hid">aa</span>.<span class="hid">remove</span>(<span class="str">&quot;abc&quot;</span>);
<span class="br">75 </span>    <span class="kwrd">assert</span>((<span class="hid">aa</span>.<span class="hid">length</span> == <span class="num">1</span>), <span class="hid">aa</span>.<span class="hid">length</span>.<span class="hid">to</span>!<span class="type">string</span>);
<span class="br">76 </span>    <span class="hid">aa</span>.<span class="hid">remove</span>(<span class="str">&quot;def&quot;</span>);
<span class="br">77 </span>    <span class="kwrd">assert</span>(!<span class="hid">aa</span>.<span class="hid">length</span>, <span class="hid">aa</span>.<span class="hid">length</span>.<span class="hid">to</span>!<span class="type">string</span>);
<span class="br">78 </span>}
<span class="br">79 </span>{
<span class="br">80 </span>    <span class="hid">RehashingAA</span>!(<span class="type">int</span>[<span class="type">string</span>]) <span class="hid">aa</span>;
<span class="br">81 </span>    <span class="hid">aa</span>[<span class="str">&quot;abc&quot;</span>] = <span class="num">123</span>;
<span class="br">82 </span>    <span class="hid">aa</span>[<span class="str">&quot;def&quot;</span>] = <span class="num">456</span>;
<span class="br">83 </span>    <span class="hid">aa</span>[<span class="str">&quot;ghi&quot;</span>] = <span class="num">789</span>;
<span class="br">84 </span>
<span class="br">85 </span>    <span class="kwrd">foreach</span> (<span class="hid">value</span>; <span class="hid">aa</span>.<span class="hid">byValue</span>)
<span class="br">86 </span>    {
<span class="br">87 </span>        <span class="kwrd">import</span> <span class="hid">std</span>.<span class="hid">algorithm</span>.<span class="hid">comparison</span> : <span class="hid">among</span>;
<span class="br">88 </span>        <span class="kwrd">assert</span>(<span class="hid">value</span>.<span class="hid">among</span>!(<span class="num">123</span>, <span class="num">456</span>, <span class="num">789</span>), <span class="hid">value</span>.<span class="hid">to</span>!<span class="type">string</span>);
<span class="br">89 </span>    }
<span class="br">90 </span>}
<span class="br">91 </span>{
<span class="br">92 </span>    <span class="hid">RehashingAA</span>!(<span class="type">int</span>[<span class="type">string</span>]) <span class="hid">aa</span>;
<span class="br">93 </span>    <span class="hid">aa</span>[<span class="str">&quot;abc&quot;</span>] = <span class="num">123</span>;
<span class="br">94 </span>    <span class="hid">aa</span>[<span class="str">&quot;def&quot;</span>] = <span class="num">456</span>;
<span class="br">95 </span>    <span class="hid">aa</span>[<span class="str">&quot;ghi&quot;</span>] = <span class="num">789</span>;
<span class="br">96 </span>
<span class="br">97 </span>    <span class="kwrd">foreach</span> (<span class="hid">key</span>; <span class="hid">aa</span>.<span class="hid">byKey</span>)
<span class="br">98 </span>    {
<span class="br">99 </span>        <span class="kwrd">assert</span>(<span class="hid">key</span> <span class="kwrd">in</span> <span class="hid">aa</span>);
<span class="br">100 </span>    }
<span class="br">101 </span>}
<span class="br">102 </span>{
<span class="br">103 </span>    <span class="hid">RehashingAA</span>!(<span class="type">int</span>[<span class="type">string</span>]) <span class="hid">aa</span>;
<span class="br">104 </span>    <span class="hid">aa</span>[<span class="str">&quot;abc&quot;</span>] = <span class="num">123</span>;
<span class="br">105 </span>    <span class="hid">aa</span>[<span class="str">&quot;def&quot;</span>] = <span class="num">456</span>;
<span class="br">106 </span>    <span class="hid">aa</span>[<span class="str">&quot;ghi&quot;</span>] = <span class="num">789</span>;
<span class="br">107 </span>
<span class="br">108 </span>    <span class="kwrd">auto</span> <span class="hid">values</span> = <span class="hid">aa</span>.<span class="hid">values</span>;  <span class="com">// allocate it once</span>
<span class="br">109 </span>
<span class="br">110 </span>    <span class="com">// Order cannot be relied upon</span>
<span class="br">111 </span>    <span class="kwrd">foreach</span> (<span class="hid">val</span>; [ <span class="num">123</span>, <span class="num">456</span>, <span class="num">789</span> ])
<span class="br">112 </span>    {
<span class="br">113 </span>        <span class="kwrd">import</span> <span class="hid">std</span>.<span class="hid">algorithm</span>.<span class="hid">searching</span> : <span class="hid">canFind</span>;
<span class="br">114 </span>        <span class="kwrd">assert</span>(<span class="hid">values</span>.<span class="hid">canFind</span>(<span class="hid">val</span>));
<span class="br">115 </span>    }
<span class="br">116 </span>}
<span class="br">117 </span>{
<span class="br">118 </span>    <span class="hid">RehashingAA</span>!(<span class="type">int</span>[<span class="type">string</span>]) <span class="hid">aa</span>;
<span class="br">119 </span>    <span class="hid">aa</span>[<span class="str">&quot;abc&quot;</span>] = <span class="num">123</span>;
<span class="br">120 </span>    <span class="hid">aa</span>[<span class="str">&quot;def&quot;</span>] = <span class="num">456</span>;
<span class="br">121 </span>    <span class="hid">aa</span>[<span class="str">&quot;ghi&quot;</span>] = <span class="num">789</span>;
<span class="br">122 </span>
<span class="br">123 </span>    <span class="kwrd">auto</span> <span class="hid">keys</span> = <span class="hid">aa</span>.<span class="hid">keys</span>;  <span class="com">// allocate it once</span>
<span class="br">124 </span>
<span class="br">125 </span>    <span class="com">// Order cannot be relied upon</span>
<span class="br">126 </span>    <span class="kwrd">foreach</span> (<span class="hid">key</span>; [ <span class="str">&quot;abc&quot;</span>, <span class="str">&quot;def&quot;</span>, <span class="str">&quot;ghi&quot;</span> ])
<span class="br">127 </span>    {
<span class="br">128 </span>        <span class="kwrd">assert</span>(<span class="hid">key</span> <span class="kwrd">in</span> <span class="hid">aa</span>);
<span class="br">129 </span>    }
<span class="br">130 </span>}
<span class="br">131 </span>{
<span class="br">132 </span>    <span class="hid">RehashingAA</span>!(<span class="type">int</span>[<span class="type">string</span>]) <span class="hid">aa</span>;
<span class="br">133 </span>    <span class="hid">aa</span>[<span class="str">&quot;abc&quot;</span>] = <span class="num">123</span>;
<span class="br">134 </span>    <span class="hid">aa</span>[<span class="str">&quot;def&quot;</span>] = <span class="num">456</span>;
<span class="br">135 </span>    <span class="hid">aa</span>[<span class="str">&quot;ghi&quot;</span>] = <span class="num">789</span>;
<span class="br">136 </span>
<span class="br">137 </span>    <span class="kwrd">foreach</span> (<span class="hid">kv</span>; <span class="hid">aa</span>.<span class="hid">byKeyValue</span>)
<span class="br">138 </span>    {
<span class="br">139 </span>        <span class="kwrd">assert</span>(<span class="hid">kv</span>.<span class="hid">key</span> <span class="kwrd">in</span> <span class="hid">aa</span>);
<span class="br">140 </span>        <span class="kwrd">assert</span>(<span class="hid">aa</span>[<span class="hid">kv</span>.<span class="hid">key</span>] == <span class="hid">kv</span>.<span class="hid">value</span>);
<span class="br">141 </span>    }
<span class="br">142 </span>}
<span class="br">143 </span>{
<span class="br">144 </span>    <span class="hid">RehashingAA</span>!(<span class="type">string</span>[<span class="type">int</span>]) <span class="hid">aa</span>;
<span class="br">145 </span>    <span class="type">string</span> <span class="hid">hello</span> = <span class="hid">aa</span>.<span class="hid">require</span>(<span class="num">42</span>, <span class="str">&quot;hello&quot;</span>);
<span class="br">146 </span>    <span class="kwrd">assert</span>(<span class="hid">hello</span> == <span class="str">&quot;hello&quot;</span>);
<span class="br">147 </span>    <span class="kwrd">assert</span>(<span class="hid">aa</span>[<span class="num">42</span>] == <span class="str">&quot;hello&quot;</span>);
<span class="br">148 </span>}
<span class="br">149 </span>{
<span class="br">150 </span>    <span class="hid">RehashingAA</span>!(<span class="type">int</span>[<span class="type">int</span>]) <span class="hid">aa</span>;
<span class="br">151 </span>    <span class="hid">aa</span>[<span class="num">1</span>] = <span class="num">42</span>;
<span class="br">152 </span>    <span class="hid">aa</span>[<span class="num">2</span>] = <span class="num">99</span>;
<span class="br">153 </span>
<span class="br">154 </span>    <span class="kwrd">assert</span>(<span class="hid">aa</span>.<span class="hid">get</span>(<span class="num">1</span>, <span class="num">0</span>) == <span class="num">42</span>);
<span class="br">155 </span>    <span class="kwrd">assert</span>(<span class="hid">aa</span>.<span class="hid">get</span>(<span class="num">2</span>, <span class="num">0</span>) == <span class="num">99</span>);
<span class="br">156 </span>    <span class="kwrd">assert</span>(<span class="hid">aa</span>.<span class="hid">get</span>(<span class="num">0</span>, <span class="num">0</span>) == <span class="num">0</span>);
<span class="br">157 </span>    <span class="kwrd">assert</span>(<span class="hid">aa</span>.<span class="hid">get</span>(<span class="num">3</span>, <span class="num">999</span>) == <span class="num">999</span>);
<span class="br">158 </span>
<span class="br">159 </span>    <span class="kwrd">assert</span>(<span class="num">0</span> !<span class="kwrd">in</span> <span class="hid">aa</span>);
<span class="br">160 </span>    <span class="kwrd">assert</span>(<span class="num">3</span> !<span class="kwrd">in</span> <span class="hid">aa</span>);
<span class="br">161 </span>}
<span class="br">162 </span>{
<span class="br">163 </span>    <span class="hid">RehashingAA</span>!(<span class="type">int</span>[<span class="type">int</span>]) <span class="hid">aa</span>;
<span class="br">164 </span>
<span class="br">165 </span>    <span class="kwrd">assert</span>(<span class="num">1</span> !<span class="kwrd">in</span> <span class="hid">aa</span>);
<span class="br">166 </span>
<span class="br">167 </span>    <span class="hid">aa</span>.<span class="hid">update</span>(<span class="num">1</span>,
<span class="br">168 </span>        () =&gt; <span class="num">42</span>,
<span class="br">169 </span>        (<span class="type">int</span> <span class="hid">i</span>) =&gt; <span class="hid">i</span> + <span class="num">1</span>);
<span class="br">170 </span>    <span class="kwrd">assert</span>(<span class="hid">aa</span>[<span class="num">1</span>] == <span class="num">42</span>);
<span class="br">171 </span>
<span class="br">172 </span>    <span class="hid">aa</span>.<span class="hid">update</span>(<span class="num">1</span>,
<span class="br">173 </span>        () =&gt; <span class="num">42</span>,
<span class="br">174 </span>        (<span class="type">int</span> <span class="hid">i</span>) =&gt; <span class="hid">i</span> + <span class="num">1</span>);
<span class="br">175 </span>    <span class="kwrd">assert</span>(<span class="hid">aa</span>[<span class="num">1</span>] == <span class="num">43</span>);
<span class="br">176 </span>}
<span class="br">177 </span>{
<span class="br">178 </span>    <span class="hid">RehashingAA</span>!(<span class="type">string</span>[<span class="type">int</span>]) <span class="hid">aa1</span>;
<span class="br">179 </span>    <span class="hid">aa1</span>[<span class="num">1</span>] = <span class="str">&quot;one&quot;</span>;
<span class="br">180 </span>
<span class="br">181 </span>    <span class="hid">RehashingAA</span>!(<span class="type">string</span>[<span class="type">int</span>]) <span class="hid">aa2</span>;
<span class="br">182 </span>    <span class="hid">aa2</span>[<span class="num">1</span>] = <span class="str">&quot;one&quot;</span>;
<span class="br">183 </span>    <span class="kwrd">assert</span>(<span class="hid">aa1</span> == <span class="hid">aa2</span>);
<span class="br">184 </span>
<span class="br">185 </span>    <span class="hid">aa2</span>[<span class="num">2</span>] = <span class="str">&quot;two&quot;</span>;
<span class="br">186 </span>    <span class="kwrd">assert</span>(<span class="hid">aa1</span> != <span class="hid">aa2</span>);
<span class="br">187 </span>
<span class="br">188 </span>    <span class="hid">aa1</span>[<span class="num">2</span>] = <span class="str">&quot;two&quot;</span>;
<span class="br">189 </span>    <span class="kwrd">assert</span>(<span class="hid">aa1</span> == <span class="hid">aa2</span>);
<span class="br">190 </span>}
<span class="br">191 </span>{
<span class="br">192 </span>    <span class="hid">RehashingAA</span>!(<span class="type">string</span>[<span class="type">int</span>]) <span class="hid">aa1</span>;
<span class="br">193 </span>    <span class="hid">aa1</span>[<span class="num">1</span>] = <span class="str">&quot;one&quot;</span>;
<span class="br">194 </span>    <span class="hid">aa1</span>[<span class="num">2</span>] = <span class="str">&quot;two&quot;</span>;
<span class="br">195 </span>
<span class="br">196 </span>    <span class="type">string</span>[<span class="type">int</span>] <span class="hid">aa2</span>;
<span class="br">197 </span>    <span class="hid">aa2</span>[<span class="num">1</span>] = <span class="str">&quot;one&quot;</span>;
<span class="br">198 </span>
<span class="br">199 </span>    <span class="kwrd">assert</span>(<span class="hid">aa1</span> != <span class="hid">aa2</span>);
<span class="br">200 </span>
<span class="br">201 </span>    <span class="hid">aa2</span>[<span class="num">2</span>] = <span class="str">&quot;two&quot;</span>;
<span class="br">202 </span>    <span class="kwrd">assert</span>(<span class="hid">aa1</span> == <span class="hid">aa2</span>);
<span class="br">203 </span>}
<span class="br">204 </span>{
<span class="br">205 </span>    <span class="hid">RehashingAA</span>!(<span class="type">string</span>[<span class="type">int</span>]) <span class="hid">aa</span>;
<span class="br">206 </span>    <span class="type">int</span> <span class="hid">i</span> = <span class="hid">aa</span>.<span class="hid">uniqueKey</span>;
<span class="br">207 </span>    <span class="kwrd">assert</span>(<span class="hid">i</span> &gt; <span class="num">0</span>);
<span class="br">208 </span>    <span class="kwrd">assert</span>(<span class="hid">i</span> <span class="kwrd">in</span> <span class="hid">aa</span>);
<span class="br">209 </span>    <span class="kwrd">assert</span>(<span class="hid">aa</span>[<span class="hid">i</span>] == <span class="type">string</span>.<span class="hid">init</span>);
<span class="br">210 </span>}</pre></div></div></div>
		<div id="page-nav"><a class="parent" href="lu.html">lu</a> <a class="parent" href="lu.container.html">container</a> 
		<span class="type-separator">functions</span><ul><li><a class="function" href="lu.container.mutexedAA.1.html">mutexedAA</a></li><li><a class="function" href="lu.container.rehashingAA.html">rehashingAA</a></li></ul><span class="type-separator">structs</span><ul><li><a class="struct" href="lu.container.Buffer.html">Buffer</a></li><li><a class="struct" href="lu.container.CircularBuffer.html">CircularBuffer</a></li><li><a class="struct" href="lu.container.MutexedAA.html">MutexedAA</a></li><li><a class="struct current" href="lu.container.RehashingAA.html">RehashingAA</a></li></ul></div>
	</div>
	<div id="page-footer">Page generated by <a href="https://github.com/adamdruppe/adrdox">adrdox</a></div>
</body>
</html>